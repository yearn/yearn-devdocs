"use strict";(self.webpackChunkyearn_devdocs=self.webpackChunkyearn_devdocs||[]).push([[8100],{51347:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>l,contentTitle:()=>c,default:()=>o,frontMatter:()=>d,metadata:()=>i,toc:()=>a});var n=t(74848),s=t(28453);const d={},c="AprOracle",i={id:"smart-contracts/V3/Periphery/AprOracle",title:"AprOracle",description:"Git Source",source:"@site/docs/developers/smart-contracts/V3/Periphery/AprOracle.md",sourceDirName:"smart-contracts/V3/Periphery",slug:"/smart-contracts/V3/Periphery/AprOracle",permalink:"/developers/smart-contracts/V3/Periphery/AprOracle",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedAt:1731361534e3,frontMatter:{},sidebar:"developers",previous:{title:"AccountantFactory",permalink:"/developers/smart-contracts/V3/Periphery/AccountantFactory"},next:{title:"Auction",permalink:"/developers/smart-contracts/V3/Periphery/Auction"}},l={},a=[{value:"State Variables",id:"state-variables",level:2},{value:"oracles",id:"oracles",level:3},{value:"MAX_BPS",id:"max_bps",level:3},{value:"MAX_BPS_EXTENDED",id:"max_bps_extended",level:3},{value:"SECONDS_PER_YEAR",id:"seconds_per_year",level:3},{value:"LEGACY_ORACLE",id:"legacy_oracle",level:3},{value:"Functions",id:"functions",level:2},{value:"constructor",id:"constructor",level:3},{value:"getStrategyApr",id:"getstrategyapr",level:3},{value:"setOracle",id:"setoracle",level:3},{value:"getCurrentApr",id:"getcurrentapr",level:3},{value:"getExpectedApr",id:"getexpectedapr",level:3},{value:"getWeightedAverageApr",id:"getweightedaverageapr",level:3}];function h(e){const r={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.header,{children:(0,n.jsx)(r.h1,{id:"aproracle",children:"AprOracle"})}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.a,{href:"https://github.com/yearn/tokenized-strategy-periphery/blob/47e243f39ea0af6568d38d6425354208999e629d/src/AprOracle/AprOracle.sol",children:"Git Source"})}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"Inherits:"})," Governance"]}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"Author:"}),"\nYearn.finance"]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.em,{children:"Contract to easily retrieve the APR's of V3 vaults and\nstrategies.\nCan be used to check the current APR of any vault or strategy\nbased on the current profit unlocking rate. As well as the\nexpected APR given some change in totalAssets.\nThis can also be used to retrieve the expected APR a strategy\nis making, thats yet to be reported, if a strategy specific\noracle has been added.\nNOTE: All values are just at the specific time called and subject\nto change."})}),"\n",(0,n.jsx)(r.h2,{id:"state-variables",children:"State Variables"}),"\n",(0,n.jsx)(r.h3,{id:"oracles",children:"oracles"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-solidity",children:"mapping(address => address) public oracles;\n"})}),"\n",(0,n.jsx)(r.h3,{id:"max_bps",children:"MAX_BPS"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-solidity",children:"uint256 internal constant MAX_BPS = 10_000;\n"})}),"\n",(0,n.jsx)(r.h3,{id:"max_bps_extended",children:"MAX_BPS_EXTENDED"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-solidity",children:"uint256 internal constant MAX_BPS_EXTENDED = 1_000_000_000_000;\n"})}),"\n",(0,n.jsx)(r.h3,{id:"seconds_per_year",children:"SECONDS_PER_YEAR"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-solidity",children:"uint256 internal constant SECONDS_PER_YEAR = 31_556_952;\n"})}),"\n",(0,n.jsx)(r.h3,{id:"legacy_oracle",children:"LEGACY_ORACLE"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-solidity",children:"address internal constant LEGACY_ORACLE = 0x27aD2fFc74F74Ed27e1C0A19F1858dD0963277aE;\n"})}),"\n",(0,n.jsx)(r.h2,{id:"functions",children:"Functions"}),"\n",(0,n.jsx)(r.h3,{id:"constructor",children:"constructor"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-solidity",children:"constructor(address _governance) Governance(_governance);\n"})}),"\n",(0,n.jsx)(r.h3,{id:"getstrategyapr",children:"getStrategyApr"}),"\n",(0,n.jsx)(r.p,{children:"Get the current APR a strategy is earning."}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsxs)(r.em,{children:["Will revert if an oracle has not been set for that strategy.\nThis will be different than the ",(0,n.jsx)(r.code,{children:"getExpectedApr()"})," which returns\nthe current APR based off of previously reported profits that\nare currently unlocking.\nThis will return the APR the strategy is currently earning that\nhas yet to be reported."]})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-solidity",children:"function getStrategyApr(address _strategy, int256 _debtChange) public view virtual returns (uint256 apr);\n"})}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"Parameters"})}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Name"}),(0,n.jsx)(r.th,{children:"Type"}),(0,n.jsx)(r.th,{children:"Description"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"_strategy"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"address"})}),(0,n.jsx)(r.td,{children:"Address of the strategy to check."})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"_debtChange"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"int256"})}),(0,n.jsx)(r.td,{children:"Positive or negative change in debt."})]})]})]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"Returns"})}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Name"}),(0,n.jsx)(r.th,{children:"Type"}),(0,n.jsx)(r.th,{children:"Description"})]})}),(0,n.jsx)(r.tbody,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"apr"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"uint256"})}),(0,n.jsx)(r.td,{children:"The expected APR it will be earning represented as 1e18."})]})})]}),"\n",(0,n.jsx)(r.h3,{id:"setoracle",children:"setOracle"}),"\n",(0,n.jsxs)(r.p,{children:["Set a custom APR ",(0,n.jsx)(r.code,{children:"_oracle"})," for a ",(0,n.jsx)(r.code,{children:"_strategy"}),"."]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsxs)(r.em,{children:["Can only be called by the Apr Oracle's ",(0,n.jsx)(r.code,{children:"governance"})," or\nmanagement of the ",(0,n.jsx)(r.code,{children:"_strategy"}),".\nThe ",(0,n.jsx)(r.code,{children:"_oracle"})," will need to implement the IOracle interface."]})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-solidity",children:"function setOracle(address _strategy, address _oracle) external virtual;\n"})}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"Parameters"})}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Name"}),(0,n.jsx)(r.th,{children:"Type"}),(0,n.jsx)(r.th,{children:"Description"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"_strategy"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"address"})}),(0,n.jsx)(r.td,{children:"Address of the strategy."})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"_oracle"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"address"})}),(0,n.jsx)(r.td,{children:"Address of the APR Oracle."})]})]})]}),"\n",(0,n.jsx)(r.h3,{id:"getcurrentapr",children:"getCurrentApr"}),"\n",(0,n.jsx)(r.p,{children:"Get the current APR for a V3 vault or strategy."}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.em,{children:"This returns the current APR based off the current\nrate of profit unlocking for either a vault or strategy.\nWill return 0 if there is no profit unlocking or no assets."})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-solidity",children:"function getCurrentApr(address _vault) external view virtual returns (uint256 apr);\n"})}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"Parameters"})}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Name"}),(0,n.jsx)(r.th,{children:"Type"}),(0,n.jsx)(r.th,{children:"Description"})]})}),(0,n.jsx)(r.tbody,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"_vault"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"address"})}),(0,n.jsx)(r.td,{children:"The address of the vault or strategy."})]})})]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"Returns"})}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Name"}),(0,n.jsx)(r.th,{children:"Type"}),(0,n.jsx)(r.th,{children:"Description"})]})}),(0,n.jsx)(r.tbody,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"apr"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"uint256"})}),(0,n.jsx)(r.td,{children:"The current apr expressed as 1e18."})]})})]}),"\n",(0,n.jsx)(r.h3,{id:"getexpectedapr",children:"getExpectedApr"}),"\n",(0,n.jsxs)(r.p,{children:["Get the expected APR for a V3 vault or strategy based on ",(0,n.jsx)(r.code,{children:"_delta"}),"."]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.em,{children:"This returns the expected APR based off the current\nrate of profit unlocking for either a vault or strategy\ngiven some change in the total assets.\nWill return 0 if there is no profit unlocking or no assets.\nThis can be used to predict the change in current apr given some\ndeposit or withdraw to the vault."})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-solidity",children:"function getExpectedApr(address _vault, int256 _delta) public view virtual returns (uint256 apr);\n"})}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"Parameters"})}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Name"}),(0,n.jsx)(r.th,{children:"Type"}),(0,n.jsx)(r.th,{children:"Description"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"_vault"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"address"})}),(0,n.jsx)(r.td,{children:"The address of the vault or strategy."})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"_delta"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"int256"})}),(0,n.jsxs)(r.td,{children:["The positive or negative change in ",(0,n.jsx)(r.code,{children:"totalAssets"}),"."]})]})]})]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"Returns"})}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Name"}),(0,n.jsx)(r.th,{children:"Type"}),(0,n.jsx)(r.th,{children:"Description"})]})}),(0,n.jsx)(r.tbody,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"apr"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"uint256"})}),(0,n.jsx)(r.td,{children:"The expected apr expressed as 1e18."})]})})]}),"\n",(0,n.jsx)(r.h3,{id:"getweightedaverageapr",children:"getWeightedAverageApr"}),"\n",(0,n.jsx)(r.p,{children:"Get the current weighted average APR for a V3 vault."}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.em,{children:"This is the sum of all the current APR's of the strategies in the vault."})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-solidity",children:"function getWeightedAverageApr(address _vault, int256 _delta) public view virtual returns (uint256);\n"})}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"Parameters"})}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Name"}),(0,n.jsx)(r.th,{children:"Type"}),(0,n.jsx)(r.th,{children:"Description"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"_vault"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"address"})}),(0,n.jsx)(r.td,{children:"The address of the vault."})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"_delta"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"int256"})}),(0,n.jsx)(r.td,{})]})]})]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.strong,{children:"Returns"})}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Name"}),(0,n.jsx)(r.th,{children:"Type"}),(0,n.jsx)(r.th,{children:"Description"})]})}),(0,n.jsx)(r.tbody,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"<none>"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"uint256"})}),(0,n.jsx)(r.td,{children:"apr The weighted average apr expressed as 1e18."})]})})]})]})}function o(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},28453:(e,r,t)=>{t.d(r,{R:()=>c,x:()=>i});var n=t(96540);const s={},d=n.createContext(s);function c(e){const r=n.useContext(d);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),n.createElement(d.Provider,{value:r},e.children)}}}]);