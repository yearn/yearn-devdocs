"use strict";(self.webpackChunkyearn_devdocs=self.webpackChunkyearn_devdocs||[]).push([[1705],{60638:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>o,contentTitle:()=>i,default:()=>h,frontMatter:()=>n,metadata:()=>l,toc:()=>d});var a=s(74848),r=s(28453);const n={},i="Integrating V3 Vaults",l={id:"v3/Integrating_v3",title:"Integrating V3 Vaults",description:"V3 provides all of the same benefits to integrators as V2, but with increased optionality and standardization.",source:"@site/docs/developers/v3/Integrating_v3.md",sourceDirName:"v3",slug:"/v3/Integrating_v3",permalink:"/developers/v3/Integrating_v3",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedAt:1718899246e3,frontMatter:{},sidebar:"mySidebar",previous:{title:"Overview",permalink:"/developers/v3/overview"},next:{title:'Guide to creating V3 "Tokenized Strategies"',permalink:"/developers/v3/strategy_writing_guide"}},o={},d=[{value:"Vaults",id:"vaults",level:2},{value:"Deposits",id:"deposits",level:3},{value:"Withdrawals",id:"withdrawals",level:3},{value:"Optional Parameters",id:"optional-parameters",level:4},{value:"<code>maxLoss</code>",id:"maxloss",level:4},{value:"<code>strategies</code>",id:"strategies",level:4},{value:"Pricing",id:"pricing",level:3},{value:"Periphery",id:"periphery",level:2},{value:"Registry",id:"registry",level:3},{value:"Role Manager",id:"role-manager",level:3},{value:"Category",id:"category",level:4}];function c(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.h1,{id:"integrating-v3-vaults",children:"Integrating V3 Vaults"}),"\n",(0,a.jsx)(t.p,{children:"V3 provides all of the same benefits to integrators as V2, but with increased optionality and standardization."}),"\n",(0,a.jsx)(t.h2,{id:"vaults",children:"Vaults"}),"\n",(0,a.jsxs)(t.p,{children:["All V3 vaults, whether multi-strategy or single-strategy, are fully ",(0,a.jsx)(t.a,{href:"https://eips.ethereum.org/EIPS/eip-4626",children:"ERC-4626"})," compliant which greatly simplifies and standardizes integrations."]}),"\n",(0,a.jsx)(t.h3,{id:"deposits",children:"Deposits"}),"\n",(0,a.jsxs)(t.p,{children:["Deposits follow the standard 4626 flow. It is recommended to use ",(0,a.jsx)(t.a,{href:"https://eips.ethereum.org/EIPS/eip-4626#deposit",children:(0,a.jsx)(t.code,{children:"deposit"})})," over ",(0,a.jsx)(t.a,{href:"https://eips.ethereum.org/EIPS/eip-4626#mint",children:(0,a.jsx)(t.code,{children:"mint"})})," when depositing to a Yearn vault."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-solidity",metastring:'title="Example"',children:"token.approve(vault, amount)\n\nvault.deposit(amount, receiver)\n"})}),"\n",(0,a.jsxs)(t.p,{children:["There is also a ",(0,a.jsx)(t.a,{href:"/vaults/smart-contracts/v3/periphery/Yearn4626Router",children:"4626 Router"})," available to make multi-step user flows easier."]}),"\n",(0,a.jsxs)(t.p,{children:["The max amount that a vault will accept from an address can be returned using the ",(0,a.jsx)(t.a,{href:"https://eips.ethereum.org/EIPS/eip-4626#maxdeposit",children:(0,a.jsx)(t.code,{children:"maxDeposit"})})," function."]}),"\n",(0,a.jsx)(t.h3,{id:"withdrawals",children:"Withdrawals"}),"\n",(0,a.jsxs)(t.p,{children:["The standard 4626 withdrawal functionality works for all V3 vaults, however it is recommended to use ",(0,a.jsx)(t.a,{href:"https://eips.ethereum.org/EIPS/eip-4626#redeem",children:(0,a.jsx)(t.code,{children:"redeem"})})," instead of ",(0,a.jsx)(t.a,{href:"https://eips.ethereum.org/EIPS/eip-4626#withdraw",children:(0,a.jsx)(t.code,{children:"withdraw"})}),"."]}),"\n",(0,a.jsx)(t.h4,{id:"optional-parameters",children:"Optional Parameters"}),"\n",(0,a.jsx)(t.p,{children:"V3 Vaults have additional, optional parameters that can be added during withdrawals."}),"\n",(0,a.jsx)(t.h4,{id:"maxloss",children:(0,a.jsx)(t.code,{children:"maxLoss"})}),"\n",(0,a.jsxs)(t.p,{children:["There is a ",(0,a.jsx)(t.code,{children:"maxLoss"})," parameter for both ",(0,a.jsx)(t.code,{children:"withdraw"})," and ",(0,a.jsx)(t.code,{children:"redeem"})," that is denominated in basis points. This value will enforce the max amount of allowable loss the user will accept during the withdraw and revert if the loss is over that amount."]}),"\n",(0,a.jsx)(t.admonition,{type:"note",children:(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"redeem"})," Defaults to a ",(0,a.jsx)(t.code,{children:"maxLoss"})," of 10_000 (100%), meaning it will allow any amount of loss."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"withdraw"})," Defaults to a ",(0,a.jsx)(t.code,{children:"maxLoss"})," of 0 (0%), meaning it will not allow any loss."]}),"\n"]})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-solidity",metastring:'title="Example"',children:"balance = vault.balanceOf(user)\n\nvault.redeem(balance, receiver, user, maxLoss)\n"})}),"\n",(0,a.jsx)(t.admonition,{type:"warning",children:(0,a.jsx)(t.p,{children:(0,a.jsxs)(t.strong,{children:["It is recommended to always include ",(0,a.jsx)(t.code,{children:"maxLoss"})," when possible for the final step in a withdrawal"]})})}),"\n",(0,a.jsx)(t.h4,{id:"strategies",children:(0,a.jsx)(t.code,{children:"strategies"})}),"\n",(0,a.jsxs)(t.p,{children:["Multi-strategy vaults also have an optional ",(0,a.jsx)(t.code,{children:"strategies"})," parameter which takes an array (max length of 10) of ordered strategy addresses to withdraw from. This will override the vaults ",(0,a.jsx)(t.code,{children:"default_queue"})," if the ",(0,a.jsx)(t.a,{href:"https://github.com/yearn/yearn-vaults-v3/blob/9fbc614bbce9d7cbad42e284a15f0f43cf1a673f/contracts/VaultV3.vy#L216C1-L216C18",children:(0,a.jsx)(t.code,{children:"use_default_queue"})})," flag is ",(0,a.jsx)(t.code,{children:"False"}),"."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-solidity",metastring:'title="Example"',children:"strategies = [compoundLender, aaveLender]\n\nbalance = vault.balanceOf(user)\n\nvault.redeem(balance, receiver, user, 1, strategies)\n"})}),"\n",(0,a.jsxs)(t.p,{children:["The max amount that a vault will allow an address to redeem/withdraw can be returned using the ",(0,a.jsx)(t.a,{href:"https://eips.ethereum.org/EIPS/eip-4626#maxredeem",children:(0,a.jsx)(t.code,{children:"maxRedeem/maxWithdraw"})})," functions. The multi-strategy vaults will also accept the optional parameters corresponding to redeem/withdraw in these ",(0,a.jsx)(t.code,{children:"max"})," view functions."]}),"\n",(0,a.jsx)(t.h3,{id:"pricing",children:"Pricing"}),"\n",(0,a.jsxs)(t.p,{children:["Generic pricing of vault tokens can be done using the standard 4626 ",(0,a.jsx)(t.a,{href:"https://eips.ethereum.org/EIPS/eip-4626#converttoshares",children:(0,a.jsx)(t.code,{children:"convertToShares"})})," and ",(0,a.jsx)(t.a,{href:"https://eips.ethereum.org/EIPS/eip-4626#converttoassets",children:(0,a.jsx)(t.code,{children:"convertToAssets"})})," functions."]}),"\n",(0,a.jsxs)(t.p,{children:["While Yearn takes great care to try and prevent manipulation of the conversion functions, it is important to know that are some security considerations if using these functions on chain as part of another protocol. Please read more in ",(0,a.jsx)(t.a,{href:"/partners/yvtokens-as-collateral#overview-of-yearn-vaults-as-collateral",children:"Yearn vaults as collateral"})]}),"\n",(0,a.jsxs)(t.p,{children:["V3 vaults also contain the legacy ",(0,a.jsx)(t.code,{children:"pricePerShare"})," function from the V2 Vaults implementation. However, this is intended as a simple off-chain helper and should not be used for on chain integrations due to precision loss."]}),"\n",(0,a.jsx)(t.h2,{id:"periphery",children:"Periphery"}),"\n",(0,a.jsx)(t.p,{children:"There are multiple periphery contracts that can be helpful to get information about Yearn vaults on a specific chain."}),"\n",(0,a.jsx)(t.h3,{id:"registry",children:"Registry"}),"\n",(0,a.jsx)(t.p,{children:"Retrieve all of the endorsed vaults on a specific chain."}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"getAllEndorsedVaults()"})," Returns a nested array sorted by vaults ",(0,a.jsx)(t.code,{children:"asset"})," of all endorsed vaults in that registry."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"getEndorsedVaults(address _asset)"})," Returns and array of all endorsed vaults for that asset"]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"vaultInfo(address _vault)"})," Return the ",(0,a.jsx)(t.a,{href:"/vaults/smart-contracts/v3/periphery/Registry#structs",children:(0,a.jsx)(t.code,{children:"Info"})})," struct for an endorsed vault that includes its underlying asset, release version, deployment timestamp, vault 'type' (i.e. multi-strategy or single-strategy) and any tag."]}),"\n"]}),"\n",(0,a.jsx)(t.h3,{id:"role-manager",children:"Role Manager"}),"\n",(0,a.jsxs)(t.p,{children:["Manages all of the multi-strategy vaults on a chain, and holds the ",(0,a.jsx)(t.code,{children:"role_manager"})," position for those vaults."]}),"\n",(0,a.jsxs)(t.p,{children:["All the other periphery contracts and Yearn multisigs can be retrieved from the Role manager as well using the getter functions, such as ",(0,a.jsx)(t.code,{children:"getBrain()"}),"/",(0,a.jsx)(t.code,{children:'getPositionHolder(keccak256("Brain"))'}),", ",(0,a.jsx)(t.code,{children:"getRegistry()"}),"/",(0,a.jsx)(t.code,{children:'getPositionHolder(keccak256("Registry"))'}),", ",(0,a.jsx)(t.code,{children:"getDebtAllocator(vault)"}),", ."]}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.a,{href:"/vaults/smart-contracts/v3/periphery/RoleManager#getallvaults",children:(0,a.jsx)(t.code,{children:"getAllVaults()"})})," Returns and array for all multi-strategy vaults the contract is the role manager for."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.a,{href:"/vaults/smart-contracts/v3/periphery/RoleManager#getvault",children:(0,a.jsx)(t.code,{children:"getVault(asset, apiVersion, category)"})})," Returns the vault if any based on the inputs."]}),"\n"]}),"\n",(0,a.jsx)(t.h4,{id:"category",children:"Category"}),"\n",(0,a.jsxs)(t.p,{children:['V3 introduces the concept of "categories" for vaults. This is because there will now potentially be multiple multi strategy vaults per underlying asset with the ',(0,a.jsx)(t.code,{children:"category"})," signalling the difference."]}),"\n",(0,a.jsxs)(t.p,{children:["A vault ",(0,a.jsx)(t.code,{children:"category"})," is appended to the vaults name and symbol that dictates what type of vault it is. For example, ",(0,a.jsx)(t.code,{children:"1"})," vaults are the lowest risk and most similar to the V2 style vaults."]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},28453:(e,t,s)=>{s.d(t,{R:()=>i,x:()=>l});var a=s(96540);const r={},n=a.createContext(r);function i(e){const t=a.useContext(n);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),a.createElement(n.Provider,{value:t},e.children)}}}]);