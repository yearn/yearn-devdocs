<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-developers docs-version-current docs-doc-page docs-doc-id-v2/yswaps" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">ySwaps | Yearn Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" property="og:image" content="https://docs.yearn.fi/img/YFILogoGradient.jpg"><meta data-rh="true" name="twitter:image" content="https://docs.yearn.fi/img/YFILogoGradient.jpg"><meta data-rh="true" property="og:url" content="https://docs.yearn.fi/developers/v2/yswaps"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="twitter:card" content="Yearn Finance is a suite of products in Decentralized Finance (DeFi) that provides lending aggregation, yield generation, and insurance on the Ethereum blockchain."><meta data-rh="true" name="git-url" content="https://github.com/yearn/yearn-devdocs"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-developers-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-developers-current"><meta data-rh="true" property="og:title" content="ySwaps | Yearn Docs"><meta data-rh="true" name="description" content="This document contain links to private repositories that might not be publicly available"><meta data-rh="true" property="og:description" content="This document contain links to private repositories that might not be publicly available"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.yearn.fi/developers/v2/yswaps"><link data-rh="true" rel="alternate" href="https://docs.yearn.fi/developers/v2/yswaps" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.yearn.fi/developers/v2/yswaps" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://UNKNOWN-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Yearn Docs" href="/opensearch.xml">





<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.81a7a80b.css">
<script src="/assets/js/runtime~main.12be471b.js" defer="defer"></script>
<script src="/assets/js/main.92098a5c.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="YFI Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="YFI Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/getting-started/intro">User Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/developers/building-on-yearn">Dev Docs</a><a class="navbar__item navbar__link" href="/contributing/introduction">DAO Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://blog.yearn.fi" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a href="https://discord.gg/b8ENPNqG5c" target="_blank" rel="noopener noreferrer" class="dropdown__link">Discord<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://x.com/yearnfi" target="_blank" rel="noopener noreferrer" class="dropdown__link">Twitter<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://t.me/yearnfinance/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Telegram<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://medium.com/iearn" target="_blank" rel="noopener noreferrer" class="dropdown__link">Medium<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://gov.yearn.fi" target="_blank" rel="noopener noreferrer" class="dropdown__link">Governance Forum<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://snapshot.org/#/veyfi.eth" target="_blank" rel="noopener noreferrer" class="dropdown__link">Snapshot Voting<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://github.com/yearn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><a href="https://yearn.fi" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-yearn-link" aria-label="yearn.fi"></a><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/developers/building-on-yearn">Building on Yearn</a><button aria-label="Collapse sidebar category &#x27;Building on Yearn&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/developers/v3/overview">yVaults</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/developers/data-services/yearn-data">Yearn Data Services</a><button aria-label="Expand sidebar category &#x27;Yearn Data Services&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/developers/front-end-development">Front End Development</a><button aria-label="Expand sidebar category &#x27;Front End Development&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/developers/v2/yswaps">Other Stuff</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/developers/v2/yswaps">ySwaps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/developers/auctions">Auctions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/developers/v2/ledger-plugin">Ledger Plugin</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 divider"><hr></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/developers/addresses/">Token and Contract Addresses</a><button aria-label="Expand sidebar category &#x27;Token and Contract Addresses&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 divider"><hr></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/developers/smart-contracts/">Smart Contracts</a><button aria-label="Expand sidebar category &#x27;Smart Contracts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 divider"><hr></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/developers/security/">Security</a><button aria-label="Expand sidebar category &#x27;Security&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>ySwaps</h1></header>
<p><em>This document contain links to private repositories that might not be publicly available</em></p>
<p>ySwaps is used to <strong>abstract</strong> the token trading logic from the strategies harvest method, which means strategies can focus on farming tokens and don&#x27;t have to handle tokens trading logic and paths. The &quot;swappers&quot; smart contracts allows trading optimizations and new paths to be added since the code is not hardcoded in strategies.</p>
<ul>
<li><a href="https://github.com/yearn/yswaps" target="_blank" rel="noopener noreferrer">ySwaps contracts repository</a></li>
<li><a href="https://github.com/yearn/yswaps-app" target="_blank" rel="noopener noreferrer">ySwaps scripts repository</a></li>
</ul>
<p><img decoding="async" loading="lazy" src="https://i.imgur.com/VynhCU4.png" alt="yswaps-intro-diagram" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="glossary">Glossary<a href="#glossary" class="hash-link" aria-label="Direct link to Glossary" title="Direct link to Glossary">​</a></h2>
<ul>
<li><code>sms</code>: Strategists multisig</li>
<li><code>tokenIn</code>:  Token we have and we want to trade/swap</li>
<li><code>toeknOut</code>: Token we want to obtain on the swap</li>
<li><code>hopToken</code>: Token we use as a middle step between tokenIn and tokenOut</li>
<li><code>tf</code>: Trade Factory</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="components">Components<a href="#components" class="hash-link" aria-label="Direct link to Components" title="Direct link to Components">​</a></h2>
<ul>
<li><a href="#swappers">Swappers</a></li>
<li><a href="#trade-factory">Trade Factory</a></li>
<li><a href="#solvers-scripts">Solvers Scripts</a></li>
<li><a href="#dexes-libraries">Dexes Libraries</a></li>
<li><a href="#execute-script">Execute Script</a></li>
<li><a href="#extra-toolings">Extra Toolings</a></li>
<li><a href="#procedures">Procedures</a></li>
<li><a href="#keep3r-jobs">Keep3r Jobs</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="swappers">Swappers<a href="#swappers" class="hash-link" aria-label="Direct link to Swappers" title="Direct link to Swappers">​</a></h3>
<p>Contracts in charge of making the swaps (uniswap, balancer, sushiswap, solidly and more). We can separated them in two types:</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="single-swapper">Single swapper<a href="#single-swapper" class="hash-link" aria-label="Direct link to Single swapper" title="Direct link to Single swapper">​</a></h4>
<p>Uniswap, balancer, sushiswap, etc. These are straighforward contracts that will make a simple swap on these dexes (<code>token A</code> to <code>token B</code>). It is also worth to mention that these swappers take care of few extra stuff like: <code>approval needed to make the swap</code>, <code>transfering final tokens to strategy if needed</code>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="multicall-swapper">Multicall swapper<a href="#multicall-swapper" class="hash-link" aria-label="Direct link to Multicall swapper" title="Direct link to Multicall swapper">​</a></h4>
<p>This contract will receive a bundle of transactions that are required to acquire the wanted token/tokens. This is used in specific cases where trade can not be made in a normal exchange due to liquidity issues, dex not having that token or route, needing extra steps to aquire the token such as depositing or withdrawing, and more. It is important to mention that this swapper does NOT take care of things like approvals, or transfers (important difference with <code>single swappers</code>).</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="swappers-usage">Swappers Usage<a href="#swappers-usage" class="hash-link" aria-label="Direct link to Swappers Usage" title="Direct link to Swappers Usage">​</a></h4>
<p><strong>Single swapper example:</strong> We have <code>tokenIn</code> and <code>tokenOut</code> and we know that we can go straight to sushiswap that has enought liquidity to make the trade with good conditions.</p>
<p><strong>Multicall example:</strong> We have a <code>tokenIn</code> and we want a <code>tokenOut</code>. But theres no path on any dex to do the trade directly, so we need to split the swap in two steps:</p>
<ol>
<li>Step 1: <code>tokenIn</code> for <code>hopToken</code>.</li>
<li>Step 2: <code>hopToken</code> for <code>tokenOut</code>.</li>
</ol>
<p>For this example we are gonna assume that we will need to use two different dexes for each step. Since we are gonna split the trade in two different transactions and the main objective is to use TWO DIFFERENT dexes, this is where we use the <code>Multicall Swapper</code>.Everything that requires more than just a single swap tx, will use multicall dexes.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="swapper-contracts-version-020">Swapper Contracts (version 0.2.0)<a href="#swapper-contracts-version-020" class="hash-link" aria-label="Direct link to Swapper Contracts (version 0.2.0)" title="Direct link to Swapper Contracts (version 0.2.0)">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="ethereum">Ethereum<a href="#ethereum" class="hash-link" aria-label="Direct link to Ethereum" title="Direct link to Ethereum">​</a></h5>
<ul>
<li>MultiCallOptimizedSwapper: <a href="https://etherscan.io/address/0x711d1D8E8B2b468c92c202127A2BBFEFC14bf105" target="_blank" rel="noopener noreferrer">0x711d1D8E8B2b468c92c202127A2BBFEFC14bf105</a></li>
<li>ZRX <a href="https://etherscan.io/address/0xE32dd1F66365289b7fe14e503CBB336cD5D13F09" target="_blank" rel="noopener noreferrer">0xE32dd1F66365289b7fe14e503CBB336cD5D13F09</a></li>
<li>AsyncBancor <a href="https://etherscan.io/address/0xf13b8F103690FD74B5F137eC3CF679a9D1B4BA95" target="_blank" rel="noopener noreferrer">0xf13b8F103690FD74B5F137eC3CF679a9D1B4BA95</a></li>
<li>AsyncSushiswap <a href="https://etherscan.io/address/0x408Ec47533aEF482DC8fA568c36EC0De00593f44" target="_blank" rel="noopener noreferrer">0x408Ec47533aEF482DC8fA568c36EC0De00593f44</a></li>
<li>AsyncUniswapV2 <a href="https://etherscan.io/address/0xA780b6A733D06dFf526A84c4258616b75279C763" target="_blank" rel="noopener noreferrer">0xA780b6A733D06dFf526A84c4258616b75279C763</a></li>
<li>OneInchAggregator <a href="https://etherscan.io/address/0x934D1c4ba7DF902d6cd0803882876e3C999cb406" target="_blank" rel="noopener noreferrer">0x934D1c4ba7DF902d6cd0803882876e3C999cb406</a></li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="fantom">Fantom<a href="#fantom" class="hash-link" aria-label="Direct link to Fantom" title="Direct link to Fantom">​</a></h5>
<ul>
<li>ZRX: <a href="https://ftmscan.com/address/0x0a94017DF3f8981Da97D79c28b103bAbDa0D67C7" target="_blank" rel="noopener noreferrer">0x0a94017DF3f8981Da97D79c28b103bAbDa0D67C7</a></li>
<li>MultiCallOptimizedSwapper: <a href="https://ftmscan.com/address/0x590B3e12Ded77dE66CBF45050cD07a65d1F51dDD" target="_blank" rel="noopener noreferrer">0x590B3e12Ded77dE66CBF45050cD07a65d1F51dDD</a></li>
<li>AsyncSolidly: <a href="https://ftmscan.com/address/0x2cb391afd5180a31d01bE95Bd61A757594C9295a" target="_blank" rel="noopener noreferrer">0x2cb391afd5180a31d01bE95Bd61A757594C9295a</a></li>
<li>AsyncSpiritswap: <a href="https://ftmscan.com/address/0x8d2aFF696F14b287a6E759F4bfFB6f08E92DFD20" target="_blank" rel="noopener noreferrer">0x8d2aFF696F14b287a6E759F4bfFB6f08E92DFD20</a></li>
<li>AsyncSpookyswap: <a href="https://ftmscan.com/address/0x86ee473C2eE7eB97Ee0276bE43427a6CF0cC6348" target="_blank" rel="noopener noreferrer">0x86ee473C2eE7eB97Ee0276bE43427a6CF0cC6348</a></li>
<li>SyncSpiritswap: <a href="https://ftmscan.com/address/0x923D22FE66C77E2fea215050F088AE26186F96aE" target="_blank" rel="noopener noreferrer">0x923D22FE66C77E2fea215050F088AE26186F96aE</a></li>
<li>SyncSpookyswap: <a href="https://ftmscan.com/address/0xcD00a47D9fB36B0B37D589E20fE4fB7e2D9d9e8A" target="_blank" rel="noopener noreferrer">0xcD00a47D9fB36B0B37D589E20fE4fB7e2D9d9e8A</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="trade-factory">Trade Factory<a href="#trade-factory" class="hash-link" aria-label="Direct link to Trade Factory" title="Direct link to Trade Factory">​</a></h3>
<ul>
<li>
<p>This contract has the <code>enabled trades</code> that each strategy can make. Enabled trades are just a list of possible swaps that a strategy can make. So it only contains three variables: <code>strategyAddress</code>, <code>tokenIn</code>, <code>tokenOut</code>. We have these enabled trades to know which swaps can/should be made with each strategy.</p>
</li>
<li>
<p>This contract is also in changer of verifying the trades. To do that it will use the different <code>execute</code> methods in it and call the <code>swapper contracts</code> that needs to use. Remember that <code>swappers</code> are the contracts responsible to making the actual swap.</p>
</li>
<li>
<p>When we execute the swap its important to point out that this  takes care of: <code>transfering tokenIn from strat to swapper</code>, <code>make final the check if the amount received &gt; minAmountOut</code>.</p>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="trade-factory-contracts-version-020">Trade Factory Contracts (version 0.2.0)<a href="#trade-factory-contracts-version-020" class="hash-link" aria-label="Direct link to Trade Factory Contracts (version 0.2.0)" title="Direct link to Trade Factory Contracts (version 0.2.0)">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="ethereum-1">Ethereum<a href="#ethereum-1" class="hash-link" aria-label="Direct link to Ethereum" title="Direct link to Ethereum">​</a></h5>
<ul>
<li>TradeFactory: <a href="https://etherscan.io/address/0x7BAF843e06095f68F4990Ca50161C2C4E4e01ec6" target="_blank" rel="noopener noreferrer">0x7BAF843e06095f68F4990Ca50161C2C4E4e01ec6</a></li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="fantom-1">Fantom<a href="#fantom-1" class="hash-link" aria-label="Direct link to Fantom" title="Direct link to Fantom">​</a></h5>
<ul>
<li>TradeFactory: <a href="https://ftmscan.com/address/0xD3f89C21719Ec5961a3E6B0f9bBf9F9b4180E9e9" target="_blank" rel="noopener noreferrer">0xD3f89C21719Ec5961a3E6B0f9bBf9F9b4180E9e9</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="solvers-scripts">Solvers Scripts<a href="#solvers-scripts" class="hash-link" aria-label="Direct link to Solvers Scripts" title="Direct link to Solvers Scripts">​</a></h3>
<p>Scripts in charge of providing the swap transaction that will be used and sent to <code>Trade Factory contract</code>.</p>
<ul>
<li>
<p><strong>Custom solvers</strong>: There are custom solvers for specific cases/strategies that will need to make multiple transactions for a specific swap. Each of these scripts aims to an specific strategy and trade that needs to be made. Some examples (<code>ThreePoolCrvMulticall.ts</code>). This is for specific strategies&#x27;s trades that will need to swap tokens that can not be swaped/resolved on a single dex swap. The tx provided by this solver is gonna be used with the <code>Multicall swapper</code>.</p>
</li>
<li>
<p><strong>Dexes solvers</strong>: this script is used for situations where the trade can be resolved with a normal swap on an exchange and does NOT require multiple tx to ensure the trade is possible. Different to <code>Custom Solvers</code>, this can be used in a generic way for different strategies/swaps. This script checks with every DeX and chooses the best one to make the trade. The tx provided by this solver is gonna be used with the <code>Single swapper</code>.</p>
</li>
<li>
<p><strong>Multicall Dexes solvers</strong>: This solver is gonna split the trade in different steps using the <code>hopTokens</code> provided by us. Each step of the swap will loop between every dexes library and will take the best dex for each step of the trade. This solver generally will be using the <code>MulticallSwapper</code> since we are doing 2 steps or tx for the swap. But it is also possible to use the <code>SingleSwapper</code> because if both steps of the trade are using the same Dex, we should merge them into one for gas efficiency. We will be transforming <code>2 tx</code> into <code>1 tx</code> so we can use the <code>SingleSwapper</code>.</p>
</li>
</ul>
<br>
<ul>
<li><a href="https://github.com/yearn/yswaps-app/tree/main/scripts/libraries/solvers" target="_blank" rel="noopener noreferrer">All Solvers</a></li>
<li><a href="https://github.com/yearn/yswaps-app/blob/main/scripts/libraries/solvers/Dexes.ts" target="_blank" rel="noopener noreferrer">Dexes Solver</a></li>
<li><a href="https://github.com/yearn/yswaps-app/blob/main/scripts/libraries/solvers/MulticallDexes.ts" target="_blank" rel="noopener noreferrer">Multicall Dexes Solver</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="dexes-libraries">Dexes Libraries<a href="#dexes-libraries" class="hash-link" aria-label="Direct link to Dexes Libraries" title="Direct link to Dexes Libraries">​</a></h3>
<p>There is one dex library per dex (uniswap, bancor, ...). They are in charge of getting the trade information of each Dex and returning all the data needed on the <code>Solvers</code>.</p>
<blockquote>
<p>NOTE: The libraries contemplate the hopTokens too.</p>
</blockquote>
<ul>
<li><a href="https://github.com/yearn/yswaps-app/tree/main/scripts/libraries/dexes" target="_blank" rel="noopener noreferrer">All Dexes Libraries</a></li>
<li><a href="https://github.com/yearn/yswaps-app/blob/main/scripts/libraries/dexes/bancor.ts" target="_blank" rel="noopener noreferrer">Bancor Dex Library</a></li>
<li><a href="https://github.com/yearn/yswaps-app/blob/main/scripts/libraries/dexes/uniswap-v2.ts" target="_blank" rel="noopener noreferrer">UniswapV2 Dex Library</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="execute-script">Execute script<a href="#execute-script" class="hash-link" aria-label="Direct link to Execute script" title="Direct link to Execute script">​</a></h3>
<p>This is where everything starts. Here we will grab all the enabled trades, loop and use logic to determinate if:</p>
<ol>
<li>Should the trade by executed?</li>
<li>If so, what solver should we use?</li>
<li>Once we have the solver response, execute the swap transaction provided by the solver.</li>
</ol>
<br>
<ul>
<li><a href="https://github.com/yearn/yswaps-app/blob/main/scripts/execute-mainnet-pending-trades.ts" target="_blank" rel="noopener noreferrer">Execute Mainnet pending trades</a></li>
<li><a href="https://github.com/yearn/yswaps-app/blob/main/scripts/execute-fantom-pending-trades.ts" target="_blank" rel="noopener noreferrer">Execute Fantom pending trades</a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="execute-pending-trades-what-exactly-happens">Execute pending trades: What exactly happens?<a href="#execute-pending-trades-what-exactly-happens" class="hash-link" aria-label="Direct link to Execute pending trades: What exactly happens?" title="Direct link to Execute pending trades: What exactly happens?">​</a></h4>
<ol>
<li>
<p>Script execute-mainnet-pending-trades<br>
<!-- -->1.1. Identify &quot;pending trades&quot;<br>
<!-- -->1.2. Determinate which solver to use.<br>
<!-- -->1.3. Solver determinates best Dex and returns the swap tx<br>
<!-- -->1.3. Execute swap tx provided by the solver.</p>
</li>
<li>
<p>Call the execute in Trade Factory<br>
<!-- -->2.1. Contract validates the data and that trade in configuration is valid.<br>
<!-- -->2.2 Moves the funds directly from the strategy to the swapper.<br>
<!-- -->2.3 Calls <code>swapper.swap()</code> to execute the trade.<br>
<!-- -->2.4 Check that amount received by strategy &gt; minAmountOut provided by us.</p>
</li>
<li>
<p>Swapper executes the trade<br>
<!-- -->3.1. Validates some data.<br>
<!-- -->3.2. Executes the trade<br>
<!-- -->3.3. Send funds directly to the strategy.</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="extra-toolings">Extra toolings<a href="#extra-toolings" class="hash-link" aria-label="Direct link to Extra toolings" title="Direct link to Extra toolings">​</a></h3>
<ul>
<li><strong>Gas service</strong>: provides the correct params for gas options for each network</li>
<li><strong>Price service</strong>: we use providers as CoinGecko API to normilize the <code>tokenInAmount</code> and <code>tokenOutAmount</code> in USD so we can verify that we are not getting a bad price from the Dex we ended up using.</li>
</ul>
<br>
<ul>
<li><a href="https://github.com/yearn/yswaps-app/tree/main/scripts/libraries/utils" target="_blank" rel="noopener noreferrer">Link to services scripts</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="procedures">Procedures<a href="#procedures" class="hash-link" aria-label="Direct link to Procedures" title="Direct link to Procedures">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-new-strategy">Add new strategy<a href="#add-new-strategy" class="hash-link" aria-label="Direct link to Add new strategy" title="Direct link to Add new strategy">​</a></h3>
<ol>
<li>Add <code>STRATEGY</code> role on Trade factory contract. From yMech.</li>
<li>Add <code>enable trades</code> on Trade factory contract. From strategy.</li>
<li>Add <code>enable trade</code> on ySwap repo config (<code>fantom.ts</code> <code>mainnet.ts</code>)<br>
<!-- -->3.1 To add it to the config we also need to know what solver we are going to use. It would be <code>Dexes.ts</code> which is a generic solver or it would have its own <code>Custom Solver</code><br>
<!-- -->3.2 In case of need a <code>Custom Solver</code>, we need to code it.</li>
<li>Once added to config, we are ready to execute the script to swap available trades.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="remove-strategy">Remove strategy<a href="#remove-strategy" class="hash-link" aria-label="Direct link to Remove strategy" title="Direct link to Remove strategy">​</a></h3>
<ol>
<li>Revoke role from MS.</li>
<li>Remove from network config file.</li>
<li>OPTIONAL: remove custom solver if it has one.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="keep3r-jobs">Keep3r jobs<a href="#keep3r-jobs" class="hash-link" aria-label="Direct link to Keep3r jobs" title="Direct link to Keep3r jobs">​</a></h2>
<p>Previous knowledge about how <code>Keeper Network</code> works is needed.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="procedures-1">Procedures<a href="#procedures-1" class="hash-link" aria-label="Direct link to Procedures" title="Direct link to Procedures">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="add-strategy-fantom-keeper-harvest-job">Add strategy fantom keeper harvest job<a href="#add-strategy-fantom-keeper-harvest-job" class="hash-link" aria-label="Direct link to Add strategy fantom keeper harvest job" title="Direct link to Add strategy fantom keeper harvest job">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="a">A)<a href="#a" class="hash-link" aria-label="Direct link to A)" title="Direct link to A)">​</a></h5>
<ol>
<li>Go straight to ftmscan harvest job and add the strategy manually by a yMech.</li>
<li>Add strategy to v2-ftm-strategies.ts config with <code>added: true</code></li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="b-safest-way-to-have-everything-added">B) (safest way to have everything added)<a href="#b-safest-way-to-have-everything-added" class="hash-link" aria-label="Direct link to B) (safest way to have everything added)" title="Direct link to B) (safest way to have everything added)">​</a></h5>
<ol>
<li>Review and merge pr from strategists to add new strategies.</li>
<li>On  packages/strategies-keep3r Execute script: <code>npx hardhat run scripts/jobs/detached/01-v2-harvest-ftm-detached-job-add-strategies.ts --network fantom</code></li>
<li>On config file strategies-keep3r/utils/v2-ftm-strategies.ts change once again  strategies property added to true</li>
<li>Push changes.</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="remove-strategy-fantom-keeper-harvest-job">Remove strategy fantom keeper harvest job<a href="#remove-strategy-fantom-keeper-harvest-job" class="hash-link" aria-label="Direct link to Remove strategy fantom keeper harvest job" title="Direct link to Remove strategy fantom keeper harvest job">​</a></h4>
<ol>
<li>Go to ftmscan <code>Harvest Job SC</code> and remove the strategy manually using method <code>removeStrategies</code>. Call with a mechanic.</li>
<li>Remove strategy from <code>v2-NETWORK-strategies.json</code> file.</li>
</ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-04-06T04:59:23.000Z" itemprop="dateModified">Apr 6, 2024</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/developers/v2/fork-yearn-ui"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Fork Yearn UI: create a customized stablecoins-only vaults website</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/developers/auctions"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Auctions</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#glossary" class="table-of-contents__link toc-highlight">Glossary</a></li><li><a href="#components" class="table-of-contents__link toc-highlight">Components</a><ul><li><a href="#swappers" class="table-of-contents__link toc-highlight">Swappers</a></li><li><a href="#trade-factory" class="table-of-contents__link toc-highlight">Trade Factory</a></li><li><a href="#solvers-scripts" class="table-of-contents__link toc-highlight">Solvers Scripts</a></li><li><a href="#dexes-libraries" class="table-of-contents__link toc-highlight">Dexes Libraries</a></li><li><a href="#execute-script" class="table-of-contents__link toc-highlight">Execute script</a></li><li><a href="#extra-toolings" class="table-of-contents__link toc-highlight">Extra toolings</a></li></ul></li><li><a href="#procedures" class="table-of-contents__link toc-highlight">Procedures</a><ul><li><a href="#add-new-strategy" class="table-of-contents__link toc-highlight">Add new strategy</a></li><li><a href="#remove-strategy" class="table-of-contents__link toc-highlight">Remove strategy</a></li></ul></li><li><a href="#keep3r-jobs" class="table-of-contents__link toc-highlight">Keep3r jobs</a><ul><li><a href="#procedures-1" class="table-of-contents__link toc-highlight">Procedures</a></li></ul></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>