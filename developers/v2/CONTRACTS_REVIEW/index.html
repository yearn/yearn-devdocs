<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-developers docs-version-current docs-doc-page docs-doc-id-v2/CONTRACTS_REVIEW" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Smart Contracts Review Guideline | Yearn Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" property="og:image" content="https://docs.yearn.fi/img/YFILogoGradient.jpg"><meta data-rh="true" name="twitter:image" content="https://docs.yearn.fi/img/YFILogoGradient.jpg"><meta data-rh="true" property="og:url" content="https://docs.yearn.fi/developers/v2/CONTRACTS_REVIEW"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="twitter:card" content="Yearn Finance is a suite of products in Decentralized Finance (DeFi) that provides lending aggregation, yield generation, and insurance on the Ethereum blockchain."><meta data-rh="true" name="git-url" content="https://github.com/yearn/yearn-devdocs"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-developers-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-developers-current"><meta data-rh="true" property="og:title" content="Smart Contracts Review Guideline | Yearn Docs"><meta data-rh="true" name="description" content="---"><meta data-rh="true" property="og:description" content="---"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.yearn.fi/developers/v2/CONTRACTS_REVIEW"><link data-rh="true" rel="alternate" href="https://docs.yearn.fi/developers/v2/CONTRACTS_REVIEW" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.yearn.fi/developers/v2/CONTRACTS_REVIEW" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://UNKNOWN-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Yearn Docs" href="/opensearch.xml">





<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.6146f147.css">
<script src="/assets/js/runtime~main.fe874ece.js" defer="defer"></script>
<script src="/assets/js/main.7c81eec6.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="YFI Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="YFI Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/getting-started/intro">User Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/developers/building-on-yearn">Dev Docs</a><a class="navbar__item navbar__link" href="/contributing/introduction">DAO Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://blog.yearn.fi" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a href="https://discord.gg/b8ENPNqG5c" target="_blank" rel="noopener noreferrer" class="dropdown__link">Discord<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://x.com/yearnfi" target="_blank" rel="noopener noreferrer" class="dropdown__link">Twitter<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://t.me/yearnfinance/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Telegram<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://medium.com/iearn" target="_blank" rel="noopener noreferrer" class="dropdown__link">Medium<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://gov.yearn.fi" target="_blank" rel="noopener noreferrer" class="dropdown__link">Governance Forum<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://snapshot.org/#/veyfi.eth" target="_blank" rel="noopener noreferrer" class="dropdown__link">Snapshot Voting<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://github.com/yearn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><a href="https://yearn.fi" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-yearn-link" aria-label="yearn.fi"></a><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Smart Contracts Review Guideline</h1></header>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="goals">Goals<a href="#goals" class="hash-link" aria-label="Direct link to Goals" title="Direct link to Goals">​</a></h2>
<p>This document specifies some guidelines to develop smart contracts and essential considerations when we do security reviews.</p>
<p>The information described here applies not ONLY to strategies (our main point of risk); if not, the main goal is to help all yDoers that develop or review contracts, especially Solidity.</p>
<p>The main goals are:</p>
<ul>
<li>Apply the best practices on developing smart contracts.</li>
<li>Document our experiences as learning lessons to mitigate risks and new attack vectors.</li>
<li>Reduce risks to get rekt on mainnet.</li>
<li>Discover potential issues, bugs, or exploits in the development or review phase.</li>
<li>Learn about the hacks or exploits that occurred in the DeFi ecosystem during the last months or years.</li>
</ul>
<p>This document is based on:</p>
<ul>
<li>The experience that the Yearn team has reached out to developing smart contracts and helping other protocols to mitigate risks.</li>
<li>Third sources (website, posts, and others). See more info in the <code>Sources</code> section.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="considerations">Considerations<a href="#considerations" class="hash-link" aria-label="Direct link to Considerations" title="Direct link to Considerations">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="solidity-version">Solidity Version<a href="#solidity-version" class="hash-link" aria-label="Direct link to Solidity Version" title="Direct link to Solidity Version">​</a></h3>
<p>Most smart contracts are built in Solidity (except the core contracts) and use the <code>0.6.12</code> version.</p>
<blockquote>
<p>In new Solidity versions, some considerations are not required.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="formatting--naming-conventions">Formatting &amp; Naming Conventions<a href="#formatting--naming-conventions" class="hash-link" aria-label="Direct link to Formatting &amp; Naming Conventions" title="Direct link to Formatting &amp; Naming Conventions">​</a></h2>
<p>All of us are working remotely, and each of us has different ways to develop smart contracts. So, it is extremely important to get a standard formatting and naming convention for developing smart contracts.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="formatting">Formatting<a href="#formatting" class="hash-link" aria-label="Direct link to Formatting" title="Direct link to Formatting">​</a></h3>
<p>The linting or formatting of the smart contract is a very important action to make them more readable, clear and easy to understand.</p>
<p>In our <a href="https://github.com/yearn/brownie-strategy-mix" target="_blank" rel="noopener noreferrer">Brownie Strategy Mix repo</a> we use <a href="https://www.npmjs.com/package/pretty-quick" target="_blank" rel="noopener noreferrer">Pretty Quick</a>.</p>
<p>To lint the contracts, you just need to execute the command:</p>
<p><code>yarn lint</code></p>
<blockquote>
<p>Before executing the CLI, you need to install the dependencies using <code>yarn install</code>.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="naming-conventions">Naming Conventions<a href="#naming-conventions" class="hash-link" aria-label="Direct link to Naming Conventions" title="Direct link to Naming Conventions">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="internal-or-private-functions">Internal or Private Functions<a href="#internal-or-private-functions" class="hash-link" aria-label="Direct link to Internal or Private Functions" title="Direct link to Internal or Private Functions">​</a></h4>
<p>To make the contracts more clear, a good practice is to add the <code>_</code> prefix to all the internal or private functions.
So, for example for this function</p>
<div class="language-javascript= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript= codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">function myFunction() internal {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We should use:</p>
<div class="language-javascript= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript= codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">function _myFunction() internal {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="use-constants">Use Constants<a href="#use-constants" class="hash-link" aria-label="Direct link to Use Constants" title="Direct link to Use Constants">​</a></h4>
<p>Avoid using magic numbers or values. Instead, use constants with a meaningful name (in <strong>uppercase</strong>).</p>
<p>Instead of</p>
<div class="language-javascript= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript= codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">function myFunction() public {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint256 value = aValue.mul(1234);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>use</p>
<div class="language-javascript= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript= codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Add a sentence describing what this constant means.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uint256 public constant VALUE_MULTIPLIER = 1234;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function myFunction() public {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint256 value = aValue.mul(VALUE_MULTIPLIER);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="best-practices">Best Practices<a href="#best-practices" class="hash-link" aria-label="Direct link to Best Practices" title="Direct link to Best Practices">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="reduce-bytecode-size">Reduce Bytecode Size<a href="#reduce-bytecode-size" class="hash-link" aria-label="Direct link to Reduce Bytecode Size" title="Direct link to Reduce Bytecode Size">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="use-libraries">Use libraries<a href="#use-libraries" class="hash-link" aria-label="Direct link to Use libraries" title="Direct link to Use libraries">​</a></h4>
<p>One option is creating libraries because it encapsulates logic (move logic from the contract itself to the library) and reduces the strategy bytecode size.</p>
<p>References:</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="use-interfaces">Use Interfaces<a href="#use-interfaces" class="hash-link" aria-label="Direct link to Use Interfaces" title="Direct link to Use Interfaces">​</a></h4>
<p>If the contract interacts with multiple protocols, you should use interfaces to interact with them instead of using the contract itself.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="assert-returns-values">Assert Returns values<a href="#assert-returns-values" class="hash-link" aria-label="Direct link to Assert Returns values" title="Direct link to Assert Returns values">​</a></h3>
<p>We must assert the returned values in any external call to check that the call was successful.</p>
<div class="language-solidity= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity= codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">uint256 value = externalContract.externalFunction(param1, ...paramN);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">require(value &gt; 0, &quot;invalid external value&quot;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="variables---naming-convention">Variables - Naming Convention<a href="#variables---naming-convention" class="hash-link" aria-label="Direct link to Variables - Naming Convention" title="Direct link to Variables - Naming Convention">​</a></h3>
<p>To make the code more clear and readable, we need to identify the unit in the variables that express amounts.</p>
<p>Example:</p>
<ul>
<li><code>amountInWant</code>, <code>balanceInYShares</code>, etc.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="multiple-routers">Multiple Routers<a href="#multiple-routers" class="hash-link" aria-label="Direct link to Multiple Routers" title="Direct link to Multiple Routers">​</a></h3>
<p>In case we need to use multiple routers to swap tokens, we should use this approach:</p>
<ul>
<li>Create constants for the router addresses.</li>
<li>Create a variable <code>boolean useUniswap</code> or similar.</li>
<li>Create a external/public function to switch the <code>useUniswap</code> value.</li>
<li>To get the router, use:<!-- -->
<ul>
<li><code>Router router = useUniswap ? uniswapRouter : sushiswapRouter;</code></li>
</ul>
</li>
</ul>
<p>See an example <a href="https://github.com/therealmonoloco/geist-lender-borrower/blob/master/contracts/Strategy.sol#L158" target="_blank" rel="noopener noreferrer">here</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="github-issues">Github Issues<a href="#github-issues" class="hash-link" aria-label="Direct link to Github Issues" title="Direct link to Github Issues">​</a></h2>
<p>Use a new branch for each new strategy. Some old comments have references to lines of codes in branches that were already modified. It is more complicated to follow the comment when it happens.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="known-issues">Known Issues<a href="#known-issues" class="hash-link" aria-label="Direct link to Known Issues" title="Direct link to Known Issues">​</a></h2>
<ul>
<li>If the strategy uses another vault, we should add the maxLoss setting. See comment <a href="https://github.com/jmonteer/yearnV2-strat-SNX-staking/pull/9#issuecomment-872376640" target="_blank" rel="noopener noreferrer">here</a>.</li>
<li><em>Strategy</em>.<em>liquidatePosition</em> function: This condition must be true. <code>amountNeeded == liquidatedAmount + loss</code></li>
<li><strong>Must</strong> have the health check address set.<!-- -->
<ul>
<li><a href="https://github.com/flashfish0x/Strategy0xDAOStaker/blob/ripae/contracts/GenericMasterChefStrategy.sol#L210" target="_blank" rel="noopener noreferrer">Example for Fantom</a></li>
<li><a href="https://github.com/tonkers-kuma/strategy-ssb/blob/main/contracts/Strategy.sol#L93" target="_blank" rel="noopener noreferrer">Example for Ethereum</a></li>
</ul>
</li>
<li><strong>Must</strong> use the <code>SafeMath</code> library to do calculations in the Solidity version <code>0.6.x</code>.<!-- -->
<ul>
<li>The over/underflow issues are fixed in the Solidity version <code>0.8.x</code>.</li>
<li>The <code>BaseStrategy</code> already imports and declares the <code>SafeMath</code> and <code>SafeERC20</code> libraries, so you don&#x27;t need to use the <code>using SafeMath for uint</code> statement. The same with <code>SafeERC20</code>.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="tools">Tools<a href="#tools" class="hash-link" aria-label="Direct link to Tools" title="Direct link to Tools">​</a></h2>
<ul>
<li><a href="https://www.ethsecurity.org/research-and-developer-resources/tools" target="_blank" rel="noopener noreferrer">ETH Security Tools</a></li>
<li>Trail of Bits Tools<!-- -->
<ul>
<li><a href="https://github.com/crytic/slither" target="_blank" rel="noopener noreferrer">Slither</a></li>
<li><a href="https://github.com/trailofbits/manticore" target="_blank" rel="noopener noreferrer">Manticore</a></li>
<li><a href="https://github.com/crytic/echidna" target="_blank" rel="noopener noreferrer">Echidna</a></li>
<li><a href="https://github.com/trailofbits/eth-security-toolbox/" target="_blank" rel="noopener noreferrer">Docker Image with all ToB tools</a></li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="required-checklists">Required Checklists<a href="#required-checklists" class="hash-link" aria-label="Direct link to Required Checklists" title="Direct link to Required Checklists">​</a></h2>
<p>Each strategy must pass two checklist verifications, a general checklist and another one depending on its type. Both checklists are <em><strong>required</strong></em> to deploy the strategy on any mainnet network.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="general">General<a href="#general" class="hash-link" aria-label="Direct link to General" title="Direct link to General">​</a></h3>
<p>These posts describe the most important considerations on security reviews.</p>
<ul>
<li><a href="https://ethereum.stackexchange.com/questions/8551/security-review-checklist-for-a-smart-contract" target="_blank" rel="noopener noreferrer">Stackoverflow - Security Review on Smart Contracts</a></li>
<li><a href="https://github.com/sushiswap/bentobox/blob/master/documentation/checks.txt" target="_blank" rel="noopener noreferrer">Sushiswap - Multiple Checks</a></li>
<li><a href="https://www.notonlyowner.com/learn/intro-security-hacking-smart-contracts-ethereum" target="_blank" rel="noopener noreferrer">Not Only Owner - Intro Security Hacking Smart Contracts</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="sources">Sources<a href="#sources" class="hash-link" aria-label="Direct link to Sources" title="Direct link to Sources">​</a></h2>
<ul>
<li><a href="https://halborn.com/explained-the-xtoken-hack-august-2021/" target="_blank" rel="noopener noreferrer">Explained XToken Hack</a></li>
<li><a href="http://web.archive.org/web/20220709131325/https://bzx.network/blog/post-mortem-update" target="_blank" rel="noopener noreferrer">BzX Network Post Mortem</a></li>
<li><a href="https://medium.com/immunefi/harvest-finance-uninitialized-proxies-bug-fix-postmortem-ea5c0f7af96b" target="_blank" rel="noopener noreferrer">Harvest Finance Uninitialized Proxies</a></li>
<li><a href="https://twitter.com/mudit__gupta/status/1459340913751117826?s=21" target="_blank" rel="noopener noreferrer">Uniswap V3: Risk Analysis for TWAP</a></li>
<li><a href="https://medium.com/taipei-ethereum-meetup/reason-why-you-should-use-eip1167-proxy-contract-with-tutorial-cbb776d98e53" target="_blank" rel="noopener noreferrer">Minimal Proxies - Reasons Why You Should Use EIP1167</a></li>
<li><a href="https://blog.originprotocol.com/a-minimal-proxy-in-the-wild-ae3f7b8da990" target="_blank" rel="noopener noreferrer">Origin Protocol - Understanding Minimal Proxies</a></li>
<li><a href="https://blog.openzeppelin.com/deep-dive-into-the-minimal-proxy-contract/" target="_blank" rel="noopener noreferrer">Open Zeppelin - Understanding Minimal Proxies</a></li>
<li><a href="https://blog.openzeppelin.com/deconstructing-a-solidity-contract-part-ii-creation-vs-runtime-6b9d60ecb44c/" target="_blank" rel="noopener noreferrer">Open Zeppelin - Creation vs Runtime Code</a></li>
<li><a href="https://twitter.com/tinchoabbate/status/1433435829372850180?s=21" target="_blank" rel="noopener noreferrer">Not Only Owner - Spanish &amp; English</a></li>
<li><a href="https://twitter.com/moo9000/status/1448967076698333192?s=21" target="_blank" rel="noopener noreferrer">Twitter Thread - How Your Crypto Fund or Exchange Gets Hacked</a></li>
</ul>
<hr></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-10-05T13:34:03.000Z" itemprop="dateModified">Oct 5, 2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#goals" class="table-of-contents__link toc-highlight">Goals</a></li><li><a href="#considerations" class="table-of-contents__link toc-highlight">Considerations</a><ul><li><a href="#solidity-version" class="table-of-contents__link toc-highlight">Solidity Version</a></li></ul></li><li><a href="#formatting--naming-conventions" class="table-of-contents__link toc-highlight">Formatting &amp; Naming Conventions</a><ul><li><a href="#formatting" class="table-of-contents__link toc-highlight">Formatting</a></li><li><a href="#naming-conventions" class="table-of-contents__link toc-highlight">Naming Conventions</a></li></ul></li><li><a href="#best-practices" class="table-of-contents__link toc-highlight">Best Practices</a><ul><li><a href="#reduce-bytecode-size" class="table-of-contents__link toc-highlight">Reduce Bytecode Size</a></li><li><a href="#assert-returns-values" class="table-of-contents__link toc-highlight">Assert Returns values</a></li><li><a href="#variables---naming-convention" class="table-of-contents__link toc-highlight">Variables - Naming Convention</a></li><li><a href="#multiple-routers" class="table-of-contents__link toc-highlight">Multiple Routers</a></li></ul></li><li><a href="#github-issues" class="table-of-contents__link toc-highlight">Github Issues</a></li><li><a href="#known-issues" class="table-of-contents__link toc-highlight">Known Issues</a></li><li><a href="#tools" class="table-of-contents__link toc-highlight">Tools</a></li><li><a href="#required-checklists" class="table-of-contents__link toc-highlight">Required Checklists</a><ul><li><a href="#general" class="table-of-contents__link toc-highlight">General</a></li></ul></li><li><a href="#sources" class="table-of-contents__link toc-highlight">Sources</a></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>